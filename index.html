

<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<title>T√≠nh Nhanh 6</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
body{font-family:"Segoe UI",Arial;background:linear-gradient(135deg,#dbeafe,#f0f9ff);margin:0;padding:0;}
.container{max-width:720px;margin:20px auto;background:#fff;border-radius:16px;padding:20px;
box-shadow:0 4px 10px rgba(0,0,0,0.15);}
h1{text-align:center;color:#0077cc;margin-bottom:10px;}
select,input,button{padding:8px;border-radius:8px;border:1px solid #ccc;margin:4px;}
button{background:#0077cc;color:white;cursor:pointer;transition:0.2s;}
button:hover{background:#005fa3;transform:scale(1.03);}
.card{margin-top:10px;padding:10px;border:1px solid #ddd;border-radius:10px;background:#fafafa;}
#leaderboard table{width:100%;border-collapse:collapse;}
#leaderboard th,#leaderboard td{border:1px solid #ddd;padding:6px;text-align:center;}
#feedback{font-weight:bold;margin-top:8px;}
#hintText{color:#555;font-style:italic;}
</style>
</head>
<body>
<div class="container">
<h1>üßÆ T√≠nh Nhanh 6</h1>

<audio id="soundCorrect" preload="auto">
  <source src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg" type="audio/ogg">
</audio>
<audio id="soundWrong" preload="auto">
  <source src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg" type="audio/ogg">
</audio>

<div id="loginArea" class="card">
  <h3>Nh·∫≠p t√™n h·ªçc sinh ƒë·ªÉ b·∫Øt ƒë·∫ßu</h3>
  <input id="studentName" placeholder="V√≠ d·ª•: Nguy·ªÖn Minh Anh" />
  <button id="startBtn">B·∫Øt ƒë·∫ßu</button>
</div>

<div id="mainArea" style="display:none;">
  <div class="card">
    <label>Ch·ªß ƒë·ªÅ:
      <select id="topic">
        <option value="int">S·ªë nguy√™n</option>
        <option value="fraction">Ph√¢n s·ªë</option>
        <option value="percent">Ph·∫ßn trƒÉm</option>
        <option value="expr">Bi·ªÉu th·ª©c</option>
      </select>
    </label>
    <label>ƒê·ªô kh√≥:
      <select id="level">
        <option value="1">D·ªÖ</option>
        <option value="2">Trung b√¨nh</option>
        <option value="3">Kh√≥</option>
      </select>
    </label>
    <button id="gen">Luy·ªán t·∫≠p</button>
    <button id="startTest">Thi nhanh 5 c√¢u</button>
  </div>

  <div id="problemArea" class="card" style="display:none;">
    <div id="qText" style="font-size:18px;margin-bottom:6px;"></div>
    <input id="answer" placeholder="Nh·∫≠p ƒë√°p √°n" />
    <button id="check">Ki·ªÉm tra</button>
    <button id="hintBtn">G·ª£i √Ω</button>
    <div id="feedback"></div>
    <div id="hintText"></div>
  </div>

  <div id="testArea" class="card" style="display:none;">
    <h3>Thi nhanh: <span id="qn">0</span>/5 ‚è± <span id="timer">--</span>s</h3>
    <div id="testQ" style="font-size:18px;margin-bottom:8px;"></div>
    <input id="testAns" placeholder="ƒê√°p √°n" />
    <button id="nextQ">Tr·∫£ l·ªùi</button>
    <div id="testFeedback" style="margin-top:10px;"></div>
  </div>

  <div id="leaderboard" class="card">
    <h3>üèÜ B·∫£ng x·∫øp h·∫°ng</h3>
    <table>
      <thead><tr><th>H·ªçc sinh</th><th>ƒêi·ªÉm cao nh·∫•t</th><th>Ng√†y</th></tr></thead>
      <tbody id="rankBody"></tbody>
    </table>
  </div>
</div>
</div>

<script>
let user="";
const correctSound=document.getElementById("soundCorrect");
const wrongSound=document.getElementById("soundWrong");

// ==== GI·ªåNG N√ìI ====
function speak(text){
  if(!('speechSynthesis'in window))return;
  text=text
    .replace(/√ó/g," nh√¢n ")
    .replace(/√∑/g," chia ")
    .replace(/\+/g," c·ªông ")
    .replace(/-/g," tr·ª´ ")
    .replace(/\(/g," m·ªü ngo·∫∑c ")
    .replace(/\)/g," ƒë√≥ng ngo·∫∑c ")
    .replace(/\b-([0-9]+)/g," √¢m $1");
  const voices=speechSynthesis.getVoices();
  let vi=voices.find(v=>v.lang.startsWith("vi"));
  const ut=new SpeechSynthesisUtterance(text);
  ut.lang=vi?vi.lang:"vi-VN";
  if(vi)ut.voice=vi;
  speechSynthesis.speak(ut);
}
window.speechSynthesis.onvoiceschanged=()=>{};

// ==== SINH B√ÄI TO√ÅN CHU·∫®N L·ªöP 6 ====
function randInt(a,b){return Math.floor(Math.random()*(b-a+1))+a;}

function formatInt(n){
  if(n<0) return `(${n})`;
  return `${n}`;
}

function genProblem(topic,level){
  if(topic==='int'){ // s·ªë nguy√™n c√≥ √¢m
    let a=randInt(-20*level,20*level);
    let b=randInt(-20*level,20*level);
    let ops=['+','-','√ó','√∑'];
    let op=ops[randInt(0,3)];
    if(op==='√∑'){b=randInt(1,10*level);}
    let ans;
    switch(op){
      case '+':ans=a+b;break;
      case '-':ans=a-b;break;
      case '√ó':ans=a*b;break;
      case '√∑':ans=parseFloat((a/b).toFixed(2));break;
    }
    return{q:`${formatInt(a)} ${op} ${formatInt(b)} = ?`,a:ans,hint:"√Åp d·ª•ng quy t·∫Øc c·ªông, tr·ª´, nh√¢n, chia s·ªë nguy√™n"};
  }

  if(topic==='fraction'){
    let a=randInt(1,9),b=randInt(2,9),c=randInt(1,9),d=randInt(2,9);
    let op=['+','-','√ó','√∑'][randInt(0,3)];
    let ans;
    switch(op){
      case '+':ans=parseFloat((a/b + c/d).toFixed(2));break;
      case '-':ans=parseFloat((a/b - c/d).toFixed(2));break;
      case '√ó':ans=parseFloat((a/b * c/d).toFixed(2));break;
      case '√∑':ans=parseFloat((a/b / (c/d)).toFixed(2));break;
    }
    return{q:`${a}/${b} ${op} ${c}/${d} = ?`,a:ans,hint:"Quy ƒë·ªìng ho·∫∑c nh√¢n chia ph√¢n s·ªë"};
  }

  if(topic==='percent'){
    let p=randInt(10,90);
    let n=randInt(50,500);
    return{q:`${p}% c·ªßa ${n} l√† bao nhi√™u?`,a:parseFloat((p/100*n).toFixed(2)),hint:"Nh√¢n ph·∫ßn trƒÉm v·ªõi s·ªë ƒë√≥"};
  }

  if(topic==='expr'){
    let a=randInt(-10,10),b=randInt(-10,10),c=randInt(-5,5);
    let exp=`(${formatInt(a)} + ${formatInt(b)}) √ó ${formatInt(c)}`;
    let ans=(a+b)*c;
    return{q:exp+" = ?",a:ans,hint:"T√≠nh trong ngo·∫∑c tr∆∞·ªõc"};
  }

  return{q:"5 + 7 = ?",a:12,hint:"C·ªông hai s·ªë"};
}

// ==== GIAO DI·ªÜN ====
document.getElementById("startBtn").onclick=()=>{
  user=document.getElementById("studentName").value.trim();
  if(!user){alert("Nh·∫≠p t√™n nh√©!");return;}
  localStorage.setItem("user",user);
  document.getElementById("loginArea").style.display="none";
  document.getElementById("mainArea").style.display="block";
  loadLeaderboard();
  showProblem(genProblem("int",2));
};

function showProblem(p){
  window._cur=p;
  document.getElementById("problemArea").style.display="block";
  document.getElementById("qText").textContent=p.q;
  document.getElementById("answer").value="";
  document.getElementById("feedback").textContent="";
  document.getElementById("hintText").textContent="";
  let readQ=p.q.replace(/√ó/g," nh√¢n ").replace(/√∑/g," chia ").replace(/\+/g," c·ªông ").replace(/-/g," tr·ª´ ").replace(/\b-([0-9]+)/g," √¢m $1").replace(/\(/g," m·ªü ngo·∫∑c ").replace(/\)/g," ƒë√≥ng ngo·∫∑c ");
  speak("B√†i to√°n l√†: "+readQ);
}

document.getElementById("gen").onclick=()=>{
  let t=document.getElementById("topic").value;
  let l=parseInt(document.getElementById("level").value);
  showProblem(genProblem(t,l));
};

document.getElementById("check").onclick=()=>{
  let ans=parseFloat(document.getElementById("answer").value);
  if(isNaN(ans)){alert("Nh·∫≠p s·ªë nh√©!");return;}
  let ok=Math.abs(ans-window._cur.a)<0.01;
  if(ok){
    correctSound.play();
    document.getElementById("feedback").textContent="‚úÖ ƒê√∫ng r·ªìi!";
    document.body.style.background="#e6ffed";
    speak("ƒê√∫ng r·ªìi, gi·ªèi l·∫Øm!");
  }else{
    wrongSound.play();
    let ansText=(window._cur.a+"").replace(/-/,"√¢m ");
    document.getElementById("feedback").textContent=`‚ùå Sai, ƒë√°p √°n l√†: ${ansText}`;
    document.body.style.background="#ffe6e6";
    speak("Sai r·ªìi, ƒë√°p √°n l√† "+ansText);
  }
  setTimeout(()=>document.body.style.background="linear-gradient(135deg,#dbeafe,#f0f9ff)",700);
};

document.getElementById("hintBtn").onclick=()=>{
  document.getElementById("hintText").textContent=window._cur.hint;
  speak("G·ª£i √Ω: "+window._cur.hint);
};

// ==== THI NHANH ====
let state={i:0,score:0,qs:[],timer:null,rem:0};
document.getElementById("startTest").onclick=()=>{
  let topic=document.getElementById("topic").value;
  let lvl=parseInt(document.getElementById("level").value);
  state.i=0;state.score=0;state.qs=[];
  for(let i=0;i<5;i++)state.qs.push(genProblem(topic,lvl));
  document.getElementById("testArea").style.display="block";
  nextQ();startTimer(60);
};
function nextQ(){
  if(state.i>=5){endTest();return;}
  let q=state.qs[state.i];
  document.getElementById("testQ").textContent=`C√¢u ${state.i+1}: ${q.q}`;
  document.getElementById("qn").textContent=state.i+1;
  document.getElementById("testAns").value="";
  let readQ=q.q.replace(/√ó/g," nh√¢n ").replace(/√∑/g," chia ").replace(/\+/g," c·ªông ").replace(/-/g," tr·ª´ ").replace(/\b-([0-9]+)/g," √¢m $1").replace(/\(/g," m·ªü ngo·∫∑c ").replace(/\)/g," ƒë√≥ng ngo·∫∑c ");
  speak("C√¢u s·ªë "+(state.i+1)+": "+readQ);
}
document.getElementById("nextQ").onclick=()=>{
  let ans=parseFloat(document.getElementById("testAns").value);
  let real=state.qs[state.i].a;
  if(Math.abs(ans-real)<0.01){
    state.score++;correctSound.play();speak("ƒê√∫ng r·ªìi!");
  }else{
    wrongSound.play();
    let ansText=(real+"").replace(/-/,"√¢m ");
    speak("Sai r·ªìi, ƒë√°p √°n l√† "+ansText);
  }
  state.i++;nextQ();
};
function startTimer(sec){
  state.rem=sec;document.getElementById("timer").textContent=state.rem;
  if(state.timer)clearInterval(state.timer);
  state.timer=setInterval(()=>{
    state.rem--;document.getElementById("timer").textContent=state.rem;
    if(state.rem<=0){clearInterval(state.timer);endTest();}
  },1000);
}
function endTest(){
  if(state.timer)clearInterval(state.timer);
  document.getElementById("testFeedback").textContent=`Ho√†n th√†nh! ƒêi·ªÉm: ${state.score}/5`;
  saveResult(user,state.score);
  speak("H·∫øt gi·ªù! B·∫°n ƒë∆∞·ª£c "+state.score+" ƒëi·ªÉm");
}

// ==== L∆ØU & BXH ====
function saveResult(name,score){
  const time=new Date().toLocaleString();
  let data=JSON.parse(localStorage.getItem("results")||"[]");
  data.push({name,score,time});
  localStorage.setItem("results",JSON.stringify(data));
  loadLeaderboard();
}
function loadLeaderboard(){
  let body=document.getElementById("rankBody");
  let data=JSON.parse(localStorage.getItem("results")||"[]");
  let best={};
  data.forEach(x=>{if(!best[x.name]||x.score>best[x.name].score)best[x.name]=x;});
  let arr=Object.values(best).sort((a,b)=>b.score-a.score);
  body.innerHTML=arr.map(r=>`<tr><td>${r.name}</td><td>${r.score}</td><td>${r.time}</td></tr>`).join("");
}
</script>
</body>
</html>
